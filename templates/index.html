<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>為替ヘッジ比較ツール（オプション vs 借入）</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { padding-top: 20px; }
    .card { border-radius: 1rem; }
    .table thead th { position: sticky; top: 0; background: #fff; }
    .num { text-align: right; font-variant-numeric: tabular-nums; }
    .badge { font-size: 0.9rem; }
    footer { margin-top: 40px; color: #666; }
  </style>
</head>
<body>
<div class="container">
  <h1 class="mb-3">為替ヘッジ比較ツール <small class="text-muted">（オプション vs 借入）</small></h1>
  <p class="text-secondary">パラメータを入力して、プットオプション購入とドル借入によるヘッジを比較します。金額表示は分かりやすさのためJPY換算（基準レート）です。</p>

  <div class="card p-3 mb-4">
    <form method="post">
      <div class="row g-3">
        <div class="col-md-4">
          <label class="form-label">ヘッジ元本（USD）</label>
          <input type="number" step="0.01" class="form-control" name="notional_usd" value="{{ params.notional_usd }}">
        </div>
        <div class="col-md-4">
          <label class="form-label">ドル金利（年率, %）</label>
          <input type="number" step="0.0001" class="form-control" name="usd_rate_annual" value="{{ params.usd_rate_annual }}">
        </div>
        <div class="col-md-4">
          <label class="form-label">円金利（年率, %）</label>
          <input type="number" step="0.0001" class="form-control" name="jpy_rate_annual" value="{{ params.jpy_rate_annual }}">
        </div>
        <div class="col-md-4">
          <label class="form-label">オプション料（%/月）</label>
          <input type="number" step="0.0001" class="form-control" name="option_premium_pct_per_month" value="{{ params.option_premium_pct_per_month }}">
        </div>
        <div class="col-md-4">
          <label class="form-label">基準レート（JPY/USD）</label>
          <input type="number" step="0.0001" class="form-control" name="spot_jpy_per_usd" value="{{ params.spot_jpy_per_usd }}">
        </div>
        <div class="col-md-4">
          <label class="form-label">期間（月）</label>
          <input type="number" step="0.01" class="form-control" name="months" value="{{ params.months }}">
        </div>
      </div>
      <div class="mt-3">
        <button class="btn btn-primary" type="submit">計算する</button>
      </div>
    </form>
  </div>

  {% if result %}
  <div class="row g-3">
    <div class="col-md-6">
      <div class="card p-3">
        <h5>コスト概要</h5>
        <ul class="list-group">
          <li class="list-group-item d-flex justify-content-between align-items-center">
            借入コスト
            <span class="badge bg-light text-dark">USD {{ "{:,.2f}".format(result.borrow_cost_usd) }}</span>
            <span class="badge bg-secondary">JPY {{ "{:,.0f}".format(result.borrow_cost_jpy) }}</span>
          </li>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            オプション料
            <span class="badge bg-light text-dark">USD {{ "{:,.2f}".format(result.option_cost_usd) }}</span>
            <span class="badge bg-secondary">JPY {{ "{:,.0f}".format(result.option_cost_jpy) }}</span>
          </li>
        </ul>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card p-3">
        <h5>重要な水準（ΔJPY = 円安幅, 円/ドル）</h5>
        <ul class="list-group">
          <li class="list-group-item d-flex justify-content-between align-items-center">
            オプションが借入より有利になる水準
            <span class="badge bg-success">{{ "{:,.2f}".format(result.delta_jpy_vs_borrow) }} 円</span>
          </li>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            オプション単体の損益分岐（黒字化）
            <span class="badge bg-info">{{ "{:,.2f}".format(result.delta_jpy_breakeven) }} 円</span>
          </li>
        </ul>
        <small class="text-muted mt-2 d-block">※「有利」水準 &gt;= 「黒字化」水準とは限りません。パラメータにより順序が変わる場合があります。</small>
      </div>
    </div>
  </div>

  <div class="card p-3 mt-3">
    <h5>シナリオ比較（円安/円高）</h5>
    <div class="table-responsive">
      <table class="table table-bordered align-middle">
        <thead>
          <tr>
            <th class="text-center">円変動（円/ドル）</th>
            <th class="text-center">オプション損益（JPY）</th>
            <th class="text-center">借入損益（JPY）</th>
            <th class="text-center">有利</th>
          </tr>
        </thead>
        <tbody>
          {% for row in scenarios %}
          <tr>
            <td class="num">{{ "{:+.0f}".format(row.move) }}</td>
            <td class="num">{{ "{:,.0f}".format(row.option_pnl_jpy) }}</td>
            <td class="num">{{ "{:,.0f}".format(row.borrow_pnl_jpy) }}</td>
            <td class="text-center">
              {% if row.better == "オプション" %}
              <span class="badge bg-success">オプション</span>
              {% elif row.better == "借入" %}
              <span class="badge bg-primary">借入</span>
              {% else %}
              <span class="badge bg-secondary">同等</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  {% endif %}

  <footer>
    <hr>
    <p class="small">注：本ツールは教育目的の簡易モデルです。オプションのギリシャス、ボラティリティ、スプレッド、税金、金利裁定、為替先物レート等は考慮していません。実運用では専門家にご相談ください。</p>
  </footer>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>